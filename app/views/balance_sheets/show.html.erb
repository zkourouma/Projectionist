<head>
</head>
<body>
  <%= render :partial => 'shared/logoutheader' %>
  <section class="balance-show group">
    <%= render :partial => 'shared/sidebar', locals: {projects: @projects} %>
    <form action="<%= new_user_project_url %>" method="post" style="float:right">
      <button type="submit" class="new-project-button">Create New Project</button></form>
    <article class="balance-content group">
      <div class="statement-ttm">
        <table>
          <tr>
            <th>Line item</th>
            <% @quarters.each_with_index do |quarter, q_i| %>
              <th><%= "#{quarter[0]}Q#{quarter[1]}" %></th>
            <% end %>
          </tr>
          <% @list_assumptions.each do |item| %>
            <tr>
              <td><%= item[1] %></td>
              <% @quarters.each_with_index do |q, q_i| %>
                <td><%= @metric_tree[q[1]][q[0]][item[0]].value %></td>
              <% end %>
            </tr>
          <% end %>
        </table>
      </div>
      <div class="meta-ttm">
        <table>
          <tr>
            <th>Stat</th>
            <% @quarters.each_with_index do |quarter, q_i| %>
              <th><%= "#{quarter[0]}Q#{quarter[1]}" %></th>
            <% end %>
          </tr>
          <tr>
            <td>Debt to Equity</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @balance.debt_to_equity(q[0], q[1]) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Cash per Share</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @balance.cash_per_share(q[0], q[1]) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Current Ratio</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @balance.current_ratio(q[0], q[1]) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Book Value</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @balance.book_value(q[0], q[1]) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Capital Expenditure</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @balance.capex(q[0], q[1]) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Working Capital</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @balance.working_capital(q[0], q[1]) %></td>
            <% end %>
          </tr>
        </table>
      </div>
      <% if @assumptions %>
      <div class="show-assumptions">
        <ul><strong>Assumptions</strong><br>
          <% @assumptions.each do |assume| %>
            <% if assume.assumption_type == "growth" %>
              <li> <%= assume.value*100 %>% <%= assume.time_unit %>/<%= assume.time_unit %>
                <%= assume.name %> growth</li>
            <% else %>
            <li>
              <% if assume.value > 1.001 %>
                $<%= assume.value %>mm in <%= assume.name %> in <%= assume.timespan %>
                <%= assume.time %>(s)
              <% else %>
                <%= assume.value*100 %>% in <%= assume.name %> in <%= assume.timespan %>
                <%= assume.time %>(s)
              <% end %>
            </li>
            <% end %>
          <% end %>
        </ul>
      </div>
      <% end %>
      <% unless @projects.nil? %>
      <div class="show-projects">
        <% @projects.each do |project| %>
          <a href="<%= user_project_url(project) %>"><%= project.name %></a>
        <% end %>
      </div>
      <% end %>
      <div class="financials">
        <ul>
          <li><strong>Financials</strong></li>
          <li><%= link_to "Income Statement", user_company_income_statement_url %></li>
          <li><%= link_to "Cash Flow Statement", user_company_cash_flow_url %></li>
        </ul>
      </div>
      <br><%= link_to "Back", :back %><br>
      <br><span id="user-email"><%= @user.email %></span>
    </article>
  </section>
</body>
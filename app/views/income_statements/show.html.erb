<head>
</head>
<body>
  <%= render :partial => 'shared/logoutheader' %>
  <section class="income-show group">
    <%= render :partial => 'shared/sidebar', locals: {projects: @projects} %>
    <form action="<%= new_user_project_url %>" method="post" style="float:right">
      <button type="submit" class="new-project-button">Create New Project</button></form>
      <a href="<%= add_user_company_income_statement_url %>"
        style="display:block;float:left;margin-right:20px;">Add year</a>
    <form action="<%= edit_user_company_income_statement_url %>" method="get" style="float:left">
      <label>Quarter<input type="number" name="quarter"></label>
      <label>Year<input type="number" name="year"></label>
      <button type="submit" class="edit-button">Edit Q</button></form>

    <article class="income-content group">
      <div class="statement-ttm">
        <table>
          <tr>
            <th>Line item</th>
            <% @quarters.each_with_index do |quarter, q_i| %>
              <th><%= "#{quarter[0]}Q#{quarter[1]}" %></th>
            <% end %>
          </tr>
          <% @metric_tree.each do |item, details| %>
            <% next unless IncomeStatement.relevant.has_value?(item) %>
            <tr>
              <td><%= item %></td>
              <% @quarters.each_with_index do |q, q_i| %>
                <td><% if details[q[1]][q[0]] %>
                      <%= details[q[1]][q[0]].value.round(1) %>
                    <% else %>
                    0
                    <% end %></td>
              <% end %>
            </tr>
          <% end %>
        </table>
      </div>
      <div class="meta-ttm">
        <table>
          <tr>
            <th>Stat</th>
            <% @quarters.each_with_index do |quarter, q_i| %>
              <th><%= "#{quarter[0]}Q#{quarter[1]}" %></th>
            <% end %>
          </tr>
          <tr>
            <td>Gross Profit</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @income.gross_profit(@metric_tree, q[0], q[1]).round(1) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Operating Profit</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @income.operating_profit(@metric_tree, q[0], q[1]).round(1) %></td>
            <% end %>
          </tr>
          <tr>
            <td>EBITDA</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @income.ebitda(@metric_tree, q[0], q[1]).round(1) %></td>
            <% end %>
          </tr>
          <tr>
            <td>Net Income</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @income.net_income(@metric_tree, q[0], q[1]).round(1) %></td>
            <% end %>
          </tr>
          <tr>
            <td>EPS</td>
            <% @quarters.each_with_index do |q, q_i| %>
              <td><%= @income.eps(@metric_tree, q[0], q[1]).round(1) %></td>
            <% end %>
          </tr>
        </table>
      </div>
      <% if @assumptions %>
      <div class="show-assumptions">
        <ul><strong>Assumptions</strong><br>
          <% @assumptions.each do |assume| %>
            <% if assume.assumption_type == "growth" %>
              <li> <%= assume.value*100 %>% <%= assume.time_unit %>/<%= assume.time_unit %>
                <%= assume.name %> growth</li>
            <% else %>
            <li>
              <% if assume.value > 1.001 %>
                $<%= assume.value %>mm in <%= assume.name %> per
                <%= assume.time %>
              <% else %>
                <%= assume.value*100 %>% in <%= assume.name %> per
                <%= assume.time %>
              <% end %>
            </li>
            <% end %>
          <% end %>
        </ul>
      </div>
      <% end %>
      <% unless @projects.nil? %>
      <div class="show-projects">
        <% @projects.each do |project| %>
          <a href="<%= user_project_url(project) %>"><%= project.name %></a>
        <% end %>
      </div>
      <% end %>
      <div class="financials">
        <ul>
          <li><strong>Financials</strong></li>
          <li><%= link_to "Balance Sheet", user_company_balance_sheet_url %></li>
          <li><%= link_to "Cash Flow Statement", user_company_cash_flow_url %></li>
        </ul>
      </div>
      <br><%= link_to "Back", :back %><br>
      <br><span id="user-email"><%= @user.email %></span>
    </article>
  </section>
</body>